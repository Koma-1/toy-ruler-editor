(()=>{"use strict";class t{constructor(t,e,r,s){this.id=t,this.start=e,this.end=r,this.graphicsAttributes=s}getBBox(){const t=this.start.getPosition(),e=this.end.getPosition();return t.x<e.x?t.x:e.x,t.y<e.y?t.y:e.y,{x:Math.min(t.x,e.x),y:Math.min(t.y,e.y),width:Math.abs(t.x-e.x),height:Math.abs(t.y-e.y)}}}class e{constructor(t,e,r,s){this.id=t,this.direction=e,this.baseRuler=r,this.offset=s}getPosition(){return this.baseRuler?this.baseRuler.getPosition()+this.offset:this.offset}}class r{constructor(t,e){this.xRuler=t,this.yRuler=e}getPosition(){return{x:this.xRuler.getPosition(),y:this.yRuler.getPosition()}}}class s{constructor(t){this.pos=t}getPosition(){return this.pos}}class i{constructor(t=[],e=[]){this.rulers=new Map,this.elements=[];for(const e of t)this.rulers.set(e.id,e);this.elements=e}getRuler(t){return this.rulers.get(t)}getAllRulers(){return Array.from(this.rulers.values())}getElements(){return this.elements}addElement(t){this.elements.push(t)}removeElementById(t){this.elements=this.elements.filter((e=>e.id!==t))}}class o{constructor(){this.rulerMap=new Map,this.rectMap=new Map,this.rectList=[]}parse(t){if(t.length>5e4)throw"Input XML is too large.";const e=(new DOMParser).parseFromString(t,"application/xml");e.querySelector("parsererror")?console.log("parse error"):console.log(e.documentElement.nodeName);for(const t of Array.from(e.documentElement.children))switch(t.tagName){case"ruler":this.parseRulerTag(t);break;case"rect":this.parseRectTag(t)}return new i(Array.from(this.rulerMap.values()),this.rectList)}parseRulerTag(t){const e=t.getAttribute("id"),r=t.getAttribute("direction"),s=t.getAttribute("type");if(!e||!r||!s)throw"TODO";if(this.rulerMap.has(e))throw"TODO";if("horizontal"!=r&&"vertical"!=r)throw"TODO";if("chain"!=s)throw"TODO";this.parseChainedRulerTag(t,e,r)}parseChainedRulerTag(t,r,s){const i=t.getAttribute("offsetFrom"),o=t.getAttribute("offset");if(!o)throw"TODO";const n=Number(o);if(Number.isNaN(n))throw"TODO";if(i){const t=this.rulerMap.get(i);if(!t)throw"TODO";if(t.direction!=s)throw"TODO";this.rulerMap.set(r,new e(r,s,t,n))}else this.rulerMap.set(r,new e(r,s,null,n))}parseRectTag(e){const i=e.getAttribute("id");if(!i)throw"TODO";const o=e.getAttribute("startXRuler"),n=e.getAttribute("startYRuler"),h=e.getAttribute("startX"),l=e.getAttribute("startY");let u=null;if(o&&n&&!h&&!l){const t=this.rulerMap.get(o),e=this.rulerMap.get(n);if(!t||!e)throw"TODO";if("vertical"!=t.direction||"horizontal"!=e.direction)throw"TODO";u=new r(t,e)}else{if(o||n||!h||!l)throw"TODO";{const t=Number(h),e=Number(l);if(Number.isNaN(t)||Number.isNaN(e))throw"TODO";u=new s({x:t,y:e})}}if(!u)throw"TODO";const a=e.getAttribute("endXRuler"),c=e.getAttribute("endYRuler"),d=e.getAttribute("endX"),g=e.getAttribute("endY");let m=null;if(a&&c&&!d&&!g){const t=this.rulerMap.get(a),e=this.rulerMap.get(c);if(!t||!e)throw"TODO";if("vertical"!=t.direction||"horizontal"!=e.direction)throw"TODO";m=new r(t,e)}else{if(a||c||!d||!g)throw"TODO";{const t=Number(d),e=Number(g);if(Number.isNaN(t)||Number.isNaN(e))throw"TODO";m=new s({x:t,y:e})}}if(!m)throw"TODO";const f=new t(i,u,m);this.rectList.push(f),this.rectMap.set(i,f)}}const n="http://www.w3.org/2000/svg";class h{constructor(t,e){this.model=t,this.root=e,this.dom=null}render(){this.dom||(this.dom=document.createElementNS(n,"rect"),this.root.appendChild(this.dom));const{x:t,y:e,width:r,height:s}=this.model.getBBox();this.dom.setAttribute("x",String(t)),this.dom.setAttribute("y",String(e)),this.dom.setAttribute("width",String(r)),this.dom.setAttribute("height",String(s)),this.dom.setAttribute("fill","lightgray")}}class l{constructor(t,e){this.ruler=t,this.root=e,this.dom=null}render(){const t=this.ruler.getPosition();this.dom||(this.dom=document.createElementNS(n,"line"),this.root.appendChild(this.dom)),"horizontal"===this.ruler.direction?(this.dom.setAttribute("x1","0"),this.dom.setAttribute("y1",String(t)),this.dom.setAttribute("x2",String(this.root.clientWidth)),this.dom.setAttribute("y2",String(t)),this.dom.setAttribute("stroke","#00FF00")):(this.dom.setAttribute("x1",String(t)),this.dom.setAttribute("y1","0"),this.dom.setAttribute("x2",String(t)),this.dom.setAttribute("y2",String(this.root.clientHeight)),this.dom.setAttribute("stroke","#FF0000")),this.dom.setAttribute("stroke-width","1px")}}class u{constructor(t,e){this.svgRoot=t,this.model=e}render(){for(;this.svgRoot.firstChild;)this.svgRoot.removeChild(this.svgRoot.firstChild);for(const t of this.model.getElements())new h(t,this.svgRoot).render();for(const t of this.model.getAllRulers())new l(t,this.svgRoot).render()}}const a=document.getElementById("editor"),c=document.getElementById("xmlInput"),d=document.getElementById("loadButton");let g=null;d.addEventListener("click",(()=>{const t=c.value;try{const e=(new o).parse(t);g=new u(a,e),g.render()}catch(t){console.error("XML parsing/rendering failed:",t),alert("XML parsing/rendering failed.")}}))})();